# åå°„ä»£ç ç”Ÿæˆ - å…³é”®é—®é¢˜è§£å†³

## âœ… é—®é¢˜å·²è§£å†³

### é—®é¢˜æè¿°
é¦–æ¬¡è¿è¡Œ `python test_reflection.py` æ—¶å¤±è´¥ï¼Œå› ä¸ºå¤´æ–‡ä»¶åŒ…å«äº† `#include "xxx.generated.h"`ï¼Œä½†è¯¥æ–‡ä»¶è¿˜æœªç”Ÿæˆã€‚

### è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `__has_include` æ¡ä»¶ç¼–è¯‘

**ä¹‹å‰ï¼ˆä¼šå¤±è´¥ï¼‰ï¼š**
```cpp
// common.h
struct [[refl::uclass]] Person { ... };

#include "common.generated.h"  // âŒ é¦–æ¬¡ç”Ÿæˆæ—¶æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè§£æå¤±è´¥
```

**ç°åœ¨ï¼ˆå·¥ä½œæ­£å¸¸ï¼‰ï¼š**
```cpp
// common.h  
struct [[refl::uclass]] Person { ... };

// åŒ…å«è‡ªåŠ¨ç”Ÿæˆçš„åå°„æ³¨å†Œä»£ç 
// ä½¿ç”¨æ¡ä»¶ç¼–è¯‘é¿å…é¦–æ¬¡ç”Ÿæˆæ—¶æ‰¾ä¸åˆ°æ–‡ä»¶
#if __has_include("common.generated.h")
#include "common.generated.h"
#endif
```

### å·¥ä½œåŸç†

1. **é¦–æ¬¡ç”Ÿæˆæ—¶**ï¼š
   - `__has_include("common.generated.h")` è¿”å› `false`
   - ä¸åŒ…å«è¯¥æ–‡ä»¶ï¼Œé¿å…ç¼–è¯‘é”™è¯¯
   - ç”Ÿæˆå™¨æˆåŠŸè§£æå¤´æ–‡ä»¶ï¼Œåˆ›å»º `.generated.h`

2. **åç»­ç¼–è¯‘æ—¶**ï¼š
   - `__has_include("common.generated.h")` è¿”å› `true`
   - åŒ…å«ç”Ÿæˆçš„æ–‡ä»¶ï¼Œåå°„åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## å®Œæ•´å·¥ä½œæµç¨‹

### 1. ç¼–å†™åå°„ç±»
```cpp
// src/my_class.h
#pragma once

struct [[refl::uclass]] MyClass {
    [[refl::property]]
    int value;
};

// ä½¿ç”¨æ¡ä»¶åŒ…å«ï¼ˆé‡è¦ï¼ï¼‰
#if __has_include("my_class.generated.h")
#include "my_class.generated.h"
#endif
```

### 2. è¿è¡Œç”Ÿæˆå™¨
```bash
cd Engine/Plugins/reflects/generator-test
python test_reflection.py
```

**è¾“å‡ºï¼š**
```
æ‰«æç›®å½•: .../src
  âœ“ æ‰¾åˆ°åå°„ç±»: my_class.h

ç”Ÿæˆåå°„ä»£ç :
  è¾“å…¥: my_class.h
  è¾“å‡º: intermediate/generates/my_class.generated.h
  âœ“ æˆåŠŸç”Ÿæˆ

âœ“ æ‰€æœ‰æ–‡ä»¶ç”ŸæˆæˆåŠŸ
```

### 3. ç¼–è¯‘é¡¹ç›®
```bash
cd ../../../../
xmake build generator-test
```

å› ä¸º `xmake.lua` å·²é…ç½®åŒ…å«è·¯å¾„ï¼Œç¼–è¯‘å™¨èƒ½æ‰¾åˆ°ï¼š
- âœ… `intermediate/generates/my_class.generated.h`
- âœ… åå°„åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### 4. è¿è¡Œæµ‹è¯•
```bash
xmake run generator-test
```

## ä¸ºä»€ä¹ˆä½¿ç”¨ `__has_include`ï¼Ÿ

### ä¼˜åŠ¿ âœ…

1. **é›¶æ‰‹åŠ¨å¹²é¢„** - ä¸éœ€è¦åœ¨ç”Ÿæˆå‰åæ‰‹åŠ¨ä¿®æ”¹ä»£ç 
2. **æ ‡å‡† C++17** - `__has_include` æ˜¯æ ‡å‡†ç‰¹æ€§
3. **è‡ªåŠ¨å¤„ç†** - é¦–æ¬¡ç”Ÿæˆå’Œåç»­ç¼–è¯‘éƒ½èƒ½æ­£ç¡®å·¥ä½œ
4. **æ— å‰¯ä½œç”¨** - ä¸å½±å“æ­£å¸¸çš„ç¼–è¯‘æµç¨‹

### å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆ

| æ–¹æ¡ˆ | é¦–æ¬¡ç”Ÿæˆ | åç»­ç¼–è¯‘ | ç»´æŠ¤æ€§ |
|------|---------|---------|--------|
| ç›´æ¥åŒ…å« | âŒ å¤±è´¥ | âœ… æ­£å¸¸ | å·® - éœ€è¦æ‰‹åŠ¨å¤„ç† |
| `__has_include` | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | ä¼˜ - å®Œå…¨è‡ªåŠ¨ |
| é¢„ç”Ÿæˆå ä½æ–‡ä»¶ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | ä¸­ - éœ€è¦é¢å¤–æ­¥éª¤ |

## æ ‡å‡†æ¨¡æ¿

å°†æ¥æ·»åŠ æ–°çš„åå°„ç±»æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªæ¨¡æ¿ï¼š

```cpp
#pragma once
#include <string>

// 1. æ ‡è®°åå°„ç±»
struct [[refl::uclass]] YourClass {
    [[refl::property]]
    std::string data;
};

// 2. æ¡ä»¶åŒ…å«ç”Ÿæˆçš„ä»£ç ï¼ˆå›ºå®šå†™æ³•ï¼‰
#if __has_include("your_class.generated.h")
#include "your_class.generated.h"
#endif
```

## å¿«é€Ÿæ£€æŸ¥æ¸…å•

æ¯æ¬¡æ·»åŠ æ–°çš„åå°„ç±»ï¼š

- [x] ç±»ä½¿ç”¨ `[[refl::uclass]]` æ ‡è®°
- [x] æˆå‘˜ä½¿ç”¨ `[[refl::property]]` æ ‡è®°
- [x] æ–‡ä»¶æœ«å°¾ä½¿ç”¨ `#if __has_include` æ¡ä»¶åŒ…å«
- [x] è¿è¡Œ `python test_reflection.py`
- [x] ç¡®è®¤ç”ŸæˆæˆåŠŸ
- [x] è¿è¡Œ `xmake build generator-test`

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥åŒ…å« `#include "xxx.generated.h"`ï¼Ÿ

A: å› ä¸ºé¦–æ¬¡è¿è¡Œç”Ÿæˆå™¨æ—¶ï¼Œ`.generated.h` æ–‡ä»¶è¿˜ä¸å­˜åœ¨ï¼Œä¼šå¯¼è‡´è§£æå¤±è´¥ã€‚ä½¿ç”¨ `__has_include` å¯ä»¥ä¼˜é›…åœ°å¤„ç†è¿™ç§"é¸¡ç”Ÿè›‹"çš„é—®é¢˜ã€‚

### Q: `__has_include` æ˜¯ C++ æ ‡å‡†å—ï¼Ÿ

A: æ˜¯çš„ï¼Œä» C++17 å¼€å§‹æˆä¸ºæ ‡å‡†ç‰¹æ€§ï¼Œæ‰€æœ‰ç°ä»£ç¼–è¯‘å™¨éƒ½æ”¯æŒã€‚

### Q: å¦‚æœæˆ‘å¿˜è®°å†™ `#if __has_include` æ€ä¹ˆåŠï¼Ÿ

A: é¦–æ¬¡ç”Ÿæˆä¼šå¤±è´¥ã€‚è§£å†³æ–¹æ³•ï¼š
1. æ·»åŠ  `#if __has_include` åŒ…è£¹
2. é‡æ–°è¿è¡Œ `python test_reflection.py`

### Q: ç”Ÿæˆçš„æ–‡ä»¶éœ€è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶å—ï¼Ÿ

A: é€šå¸¸ä¸éœ€è¦ã€‚å»ºè®®ï¼š
1. å°† `intermediate/` æ·»åŠ åˆ° `.gitignore`
2. åœ¨ CI/CD ä¸­è¿è¡Œç”Ÿæˆå™¨
3. æ¯ä¸ªå¼€å‘è€…æœ¬åœ°ç”Ÿæˆ

## æ€»ç»“

âœ… **å…³é”®æŠ€æœ¯ç‚¹ï¼š** ä½¿ç”¨ `#if __has_include` æ¡ä»¶ç¼–è¯‘
âœ… **é›¶é…ç½®ï¼š** xmake å·²é…ç½®å¥½åŒ…å«è·¯å¾„
âœ… **è‡ªåŠ¨åŒ–ï¼š** ä¸€æ¡å‘½ä»¤å®Œæˆæ‰¹é‡ç”Ÿæˆ
âœ… **ç±» UEï¼š** å·¥ä½œæµç¨‹ç±»ä¼¼ Unreal Engine

ç°åœ¨ç³»ç»Ÿå®Œå…¨å¯ç”¨äº†ï¼ğŸ‰
